# Development Dockerfile for admin - hot reload enabled
FROM node:22

WORKDIR /app

# Install dependencies first (cached unless package.json changes)
COPY admin/package.json admin/package-lock.json ./
RUN npm install --legacy-peer-deps

# Build and link local frontend package
WORKDIR /frontend
COPY frontend/package*.json ./
RUN npm install --legacy-peer-deps
COPY frontend/ ./
RUN npm run build:react

# Copy entrypoint script (updates frontend on every start, after volume mount)
WORKDIR /app
COPY admin/docker-entrypoint.sh /docker-entrypoint.sh
RUN chmod +x /docker-entrypoint.sh

EXPOSE 3000

ENTRYPOINT ["/docker-entrypoint.sh"]
CMD ["npm", "run", "dev"]
